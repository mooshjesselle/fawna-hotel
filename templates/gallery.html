{% extends "base.html" %}

{% block title %}Gallery{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/gallery.css') }}">
{% endblock %}

{% block content %}
<div class="gallery-container">
    <div class="gallery-header">
        <h1>Our Hotel Gallery</h1>
        <p>Explore our beautiful spaces and amenities</p>
    </div>

    {% if gallery_images %}
    <div class="carousel-wrapper">
        <div id="galleryCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2000">
            <!-- Indicators/dots -->
            <div class="carousel-indicators">
                {% for image in gallery_images %}
                <button type="button" data-bs-target="#galleryCarousel" data-bs-slide-to="{{ loop.index0 }}" 
                        {% if loop.first %}class="active"{% endif %}></button>
                {% endfor %}
            </div>

            <!-- The slideshow/carousel -->
            <div class="carousel-inner">
                {% for image in gallery_images %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                    <div class="carousel-image-container">
                        <img src="{{ url_for('static', filename='images/gallery/' + image.filename) }}" 
                             class="d-block w-100" alt="{{ image.title }}"
                             onclick="openLightbox(this, '{{ image.title }}', '{{ image.description }}')">
                        <div class="carousel-caption">
                            <h3>{{ image.title }}</h3>
                            <p>{{ image.description }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Left and right controls/icons -->
            <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
    </div>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox">
        <span class="close-lightbox">&times;</span>
        <div class="lightbox-content-container">
            <img id="lightbox-img" class="lightbox-content">
            <div class="zoom-controls">
                <button class="zoom-in" title="Zoom In">+</button>
                <button class="zoom-out" title="Zoom Out">−</button>
                <button class="zoom-reset" title="Reset Zoom">↺</button>
            </div>
        </div>
        <div class="lightbox-caption">
            <h3 id="lightbox-title"></h3>
            <p id="lightbox-description"></p>
        </div>
    </div>
    {% else %}
        <p class="no-images">No images available in the gallery.</p>
    {% endif %}
</div>

<script>
let currentScale = 1;
let isDragging = false;
let startX, startY, translateX = 0, translateY = 0;

function openLightbox(img, title, description) {
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const lightboxTitle = document.getElementById('lightbox-title');
    const lightboxDescription = document.getElementById('lightbox-description');
    
    lightboxImg.src = img.src;
    lightboxTitle.textContent = title;
    lightboxDescription.textContent = description;
    lightbox.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    // Reset zoom and position
    currentScale = 1;
    translateX = 0;
    translateY = 0;
    updateImageTransform();
}

function updateImageTransform() {
    const img = document.getElementById('lightbox-img');
    img.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentScale})`;
}

// Zoom controls
document.querySelector('.zoom-in').addEventListener('click', () => {
    currentScale = Math.min(currentScale + 0.2, 3);
    updateImageTransform();
});

document.querySelector('.zoom-out').addEventListener('click', () => {
    currentScale = Math.max(currentScale - 0.2, 0.5);
    updateImageTransform();
});

document.querySelector('.zoom-reset').addEventListener('click', () => {
    currentScale = 1;
    translateX = 0;
    translateY = 0;
    updateImageTransform();
});

// Mouse wheel zoom
document.getElementById('lightbox-img').addEventListener('wheel', (e) => {
    e.preventDefault();
    const delta = e.deltaY * -0.01;
    currentScale = Math.min(Math.max(currentScale + delta, 0.5), 3);
    updateImageTransform();
});

// Touch and drag functionality
document.getElementById('lightbox-img').addEventListener('mousedown', (e) => {
    if (currentScale > 1) {
        isDragging = true;
        startX = e.clientX - translateX;
        startY = e.clientY - translateY;
    }
});

document.addEventListener('mousemove', (e) => {
    if (isDragging) {
        translateX = e.clientX - startX;
        translateY = e.clientY - startY;
        updateImageTransform();
    }
});

document.addEventListener('mouseup', () => {
    isDragging = false;
});

// Touch events
document.getElementById('lightbox-img').addEventListener('touchstart', (e) => {
    if (currentScale > 1) {
        isDragging = true;
        startX = e.touches[0].clientX - translateX;
        startY = e.touches[0].clientY - translateY;
    }
});

document.addEventListener('touchmove', (e) => {
    if (isDragging) {
        e.preventDefault();
        translateX = e.touches[0].clientX - startX;
        translateY = e.touches[0].clientY - startY;
        updateImageTransform();
    }
});

document.addEventListener('touchend', () => {
    isDragging = false;
});

// Close lightbox when clicking the close button
document.querySelector('.close-lightbox').onclick = function() {
    document.getElementById('lightbox').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Close lightbox when clicking outside the image
document.getElementById('lightbox').onclick = function(e) {
    if (e.target === this) {
        this.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Close lightbox with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        document.getElementById('lightbox').style.display = 'none';
        document.body.style.overflow = 'auto';
    }
});
</script>
{% endblock %} 