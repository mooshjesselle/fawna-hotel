<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}{% endblock %}</title>
    <!-- Favicon configuration for better browser compatibility -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/fawna.png') }}" sizes="32x32">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/fawna.png') }}" sizes="16x16">
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='images/fawna.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/fawna.png') }}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <!-- Font Awesome with offline fallback -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" onerror="this.onerror=null;this.href='{{ url_for('static', filename='css/font-awesome.min.css') }}';">
    <!-- Local Font Awesome fallback -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}" media="print" onload="this.media='all'">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Offline Notification -->
    <div id="offline-notification" style="display:none;position:fixed;top:0;left:0;right:0;background:#dc3545;color:white;padding:10px;text-align:center;z-index:10000;font-weight:500;">
        <i class="fas fa-wifi" style="margin-right:8px;"></i>
        No Internet Connection - Some features may be limited
    </div>

    <div class="container-fluid p-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category if category != 'message' else 'info' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    // Set up CSRF token for all AJAX requests
    document.addEventListener('DOMContentLoaded', function() {
        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
        
        // Add CSRF token to all fetch requests
        const originalFetch = window.fetch;
        window.fetch = function() {
            let [resource, config] = arguments;
            if(config === undefined) {
                config = {};
            }
            if(config.headers === undefined) {
                config.headers = {};
            }
            config.headers['X-CSRFToken'] = csrfToken;
            return originalFetch(resource, config);
        };

        // Add CSRF token to all forms
        document.querySelectorAll('form').forEach(form => {
            if (!form.querySelector('input[name="csrf_token"]')) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'csrf_token';
                input.value = csrfToken;
                form.appendChild(input);
            }
        });
    });
    </script>
    
    <!-- Offline Detection Script -->
    <script>
    // Offline detection and notification
    function updateOnlineStatus() {
        const offlineNotification = document.getElementById('offline-notification');
        const isOnline = navigator.onLine;
        
        if (!isOnline) {
            offlineNotification.style.display = 'block';
            // Add some padding to body to account for notification
            document.body.style.paddingTop = '40px';
        } else {
            offlineNotification.style.display = 'none';
            document.body.style.paddingTop = '0';
        }
    }
    
    // Check online status on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateOnlineStatus();
        
        // Listen for online/offline events
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Periodic connectivity check (every 30 seconds)
        setInterval(function() {
            if (navigator.onLine) {
                // Test actual connectivity with a lightweight request
                fetch('/api/health-check', { 
                    method: 'HEAD',
                    cache: 'no-cache',
                    mode: 'no-cors'
                }).catch(function() {
                    // If fetch fails, we're offline
                    updateOnlineStatus();
                });
            }
        }, 30000);
    });
    
    // Font Awesome fallback for offline mode
    function loadFontAwesomeFallback() {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = '{{ url_for("static", filename="css/font-awesome.min.css") }}';
        link.onerror = function() {
            // If local Font Awesome also fails, add basic icon fallbacks
            const style = document.createElement('style');
            style.textContent = `
                .fas, .far, .fab { font-family: Arial, sans-serif !important; }
                .fa-wifi:before { content: "📶"; }
                .fa-bell:before { content: "🔔"; }
                .fa-user:before { content: "👤"; }
                .fa-bed:before { content: "🛏️"; }
                .fa-envelope:before { content: "✉️"; }
                .fa-sms:before { content: "📱"; }
                .fa-map-marker-alt:before { content: "📍"; }
                .fa-utensils:before { content: "🍽️"; }
                .fa-shopping-cart:before { content: "🛒"; }
                .fa-plus:before { content: "+"; }
                .fa-minus:before { content: "-"; }
                .fa-check:before { content: "✓"; }
                .fa-times:before { content: "✗"; }
                .fa-edit:before { content: "✏️"; }
                .fa-trash:before { content: "🗑️"; }
                .fa-eye:before { content: "👁️"; }
                .fa-sign-out-alt:before { content: "🚪"; }
                .fa-home:before { content: "🏠"; }
                .fa-phone:before { content: "📞"; }
                .fa-star:before { content: "⭐"; }
                .fa-heart:before { content: "❤️"; }
                .fa-search:before { content: "🔍"; }
                .fa-calendar:before { content: "📅"; }
                .fa-clock:before { content: "🕐"; }
                .fa-money-bill:before { content: "💰"; }
                .fa-credit-card:before { content: "💳"; }
                .fa-qrcode:before { content: "📱"; }
                .fa-external-link-alt:before { content: "🔗"; }
                .fa-spinner:before { content: "⏳"; }
                .fa-check-circle:before { content: "✅"; }
                .fa-exclamation-triangle:before { content: "⚠️"; }
                .fa-info-circle:before { content: "ℹ️"; }
                .fa-question-circle:before { content: "❓"; }
            `;
            document.head.appendChild(style);
        };
        document.head.appendChild(link);
    }
    
    // Load Font Awesome fallback after a short delay
    setTimeout(loadFontAwesomeFallback, 1000);
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html> 