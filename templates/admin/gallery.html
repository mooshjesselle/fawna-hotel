{% extends "admin/base_admin.html" %}

{% block title %}Manage Gallery - Admin{% endblock %}

{% block admin_content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h3>Manage Gallery</h3>
            <button type="button" class="light-button" data-bs-toggle="modal" data-bs-target="#addImageModal">
                <i class="fas fa-plus"></i> Add New Image
            </button>
        </div>
        <div class="card-body">
            <div class="row">
                {% for image in gallery_images %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        {% if image.filename %}
                        <img src="{{ url_for('static', filename='images/gallery/' + image.filename) }}" 
                             class="card-img-top" alt="{{ image.title }}"
                             style="height: 200px; object-fit: cover;"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="d-none justify-content-center align-items-center bg-light" style="height: 200px;">
                            {% if image.category == 'room' %}
                                <i class="fas fa-bed fa-4x text-secondary"></i>
                            {% elif image.category == 'dining' %}
                                <i class="fas fa-utensils fa-4x text-secondary"></i>
                            {% elif image.category == 'pool' %}
                                <i class="fas fa-swimming-pool fa-4x text-secondary"></i>
                            {% elif image.category == 'spa' %}
                                <i class="fas fa-spa fa-4x text-secondary"></i>
                            {% else %}
                                <i class="fas fa-image fa-4x text-secondary"></i>
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="d-flex justify-content-center align-items-center bg-light" style="height: 200px;">
                            {% if image.category == 'room' %}
                                <i class="fas fa-bed fa-4x text-secondary"></i>
                            {% elif image.category == 'dining' %}
                                <i class="fas fa-utensils fa-4x text-secondary"></i>
                            {% elif image.category == 'pool' %}
                                <i class="fas fa-swimming-pool fa-4x text-secondary"></i>
                            {% elif image.category == 'spa' %}
                                <i class="fas fa-spa fa-4x text-secondary"></i>
                            {% else %}
                                <i class="fas fa-image fa-4x text-secondary"></i>
                            {% endif %}
                        </div>
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ image.title }}</h5>
                            <div class="description-container" style="height: 80px; overflow-y: auto; margin-bottom: 10px;">
                                <p class="card-text">{{ image.description }}</p>
                            </div>
                            <p class="card-text">
                                <small class="text-muted">
                                    Category: 
                                    {% if image.category == 'room' %}
                                        <i class="fas fa-bed"></i>
                                    {% elif image.category == 'dining' %}
                                        <i class="fas fa-utensils"></i>
                                    {% elif image.category == 'pool' %}
                                        <i class="fas fa-swimming-pool"></i>
                                    {% elif image.category == 'spa' %}
                                        <i class="fas fa-spa"></i>
                                    {% else %}
                                        <i class="fas fa-image"></i>
                                    {% endif %}
                                    {{ image.category|title }}
                                </small>
                            </p>
                            <div class="btn-group action-buttons mt-auto" role="group">
                                <button class="btn btn-view btn-sm view-gallery-btn" 
                                        data-src="{{ url_for('static', filename='images/gallery/' + image.filename) if image.filename else '' }}"
                                        data-title="{{ image.title }}"
                                        data-description="{{ image.description }}"
                                        data-category="{{ image.category }}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-edit btn-sm edit-gallery-btn"
                                        data-id="{{ image.id }}"
                                        data-title="{{ image.title }}"
                                        data-description="{{ image.description }}"
                                        data-category="{{ image.category }}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-delete btn-sm delete-gallery-btn"
                                        data-id="{{ image.id }}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Add Image Modal -->
<div class="modal fade" id="addImageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Gallery Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('admin_add_gallery_image') }}" method="POST" enctype="multipart/form-data" id="addImageForm" novalidate>
                <div class="modal-body">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" name="title" required minlength="3" maxlength="50">
                        <div class="invalid-feedback" id="titleInvalidFeedback">
                            Please enter a valid title (3-50 characters)
                        </div>
                        <div class="word-count" id="titleWordCount">0/20 words</div>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3" required minlength="10" maxlength="500"></textarea>
                        <div class="invalid-feedback" id="descriptionInvalidFeedback">
                            Please enter a valid description (10-500 characters)
                        </div>
                        <div class="word-count" id="descWordCount">0/100 words</div>
                    </div>
                    <div class="mb-3">
                        <label for="category" class="form-label">Category</label>
                        <select class="form-control" id="category" name="category" required>
                            <option value="room">Room</option>
                            <option value="dining">Dining</option>
                            <option value="pool">Pool</option>
                            <option value="spa">Spa</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">Image</label>
                        <input type="file" class="form-control" id="image" name="image" accept="image/*" required>
                        <div class="invalid-feedback" id="imageInvalidFeedback">
                            Please select a valid image file (JPG, PNG, GIF)
                        </div>
                        <div class="form-text">Maximum file size: 5MB</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="light-button">Add Image</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- View Image Modal -->
<div class="modal fade" id="viewImageModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewImageTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <div id="viewImageContainer">
                    <img id="viewImageSrc" src="" alt="" class="img-fluid mb-3"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="d-none justify-content-center align-items-center bg-light py-5" id="viewImageFallback">
                        <i class="fas fa-image fa-5x text-secondary"></i>
                    </div>
                </div>
                <p id="viewImageDescription" class="lead"></p>
            </div>
        </div>
    </div>
</div>

<!-- Edit Image Modal -->
<div class="modal fade" id="editImageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Gallery Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editImageForm" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" id="editImageId" name="image_id">
                    <div class="mb-3">
                        <label for="editTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="editTitle" name="title" required minlength="3" maxlength="50">
                        <div class="invalid-feedback" id="editTitleInvalidFeedback">
                            Please enter a valid title (3-50 characters)
                        </div>
                        <div class="word-count" id="editTitleWordCount">0/20 words</div>
                    </div>
                    <div class="mb-3">
                        <label for="editDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="editDescription" name="description" rows="3" required minlength="10" maxlength="500"></textarea>
                        <div class="invalid-feedback" id="editDescriptionInvalidFeedback">
                            Please enter a valid description (10-500 characters)
                        </div>
                        <div class="word-count" id="editDescWordCount">0/100 words</div>
                    </div>
                    <div class="mb-3">
                        <label for="editCategory" class="form-label">Category</label>
                        <select class="form-control" id="editCategory" name="category" required>
                            <option value="room">Room</option>
                            <option value="dining">Dining</option>
                            <option value="pool">Pool</option>
                            <option value="spa">Spa</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editImage" class="form-label">New Image</label>
                        <input type="file" class="form-control" id="editImage" name="image" accept="image/*" required>
                        <div class="invalid-feedback" id="editImageInvalidFeedback">
                            Please select a valid image file (JPG, PNG, GIF)
                        </div>
                        <div class="form-text">Maximum file size: 5MB</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="light-button">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Image Modal -->
<div class="modal fade" id="deleteImageModal" tabindex="-1" aria-labelledby="deleteImageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteImageModalLabel">Delete Gallery Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this image?</p>
                <p>This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteImage()">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
let imageIdToDelete = null;
let deleteImageModal = null;

// Word count validation functions
function countWords(text) {
    return text.trim().split(/\s+/).filter(word => word.length > 0).length;
}

function hasRepeatedCharacters(text, limit = 5) {
    const repeatedCharRegex = new RegExp(`(.)\\1{${limit-1},}`, 'g');
    return repeatedCharRegex.test(text);
}

function updateWordCount(element, countElement, limit) {
    const words = countWords(element.value);
    countElement.textContent = `${words}/${limit} words`;
    
    if (words > limit) {
        countElement.classList.add('exceeded');
    } else {
        countElement.classList.remove('exceeded');
    }
}

// Image validation and loading
function validateImageFile(input) {
    const file = input.files[0];
    const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
    const maxSize = 5 * 1024 * 1024; // 5MB
    
    if (!file) {
        input.classList.add('is-invalid');
        const feedbackId = input.id === 'image' ? 'imageInvalidFeedback' : 'editImageInvalidFeedback';
        document.getElementById(feedbackId).textContent = 'Please select an image file';
        return false;
    }
    
    if (!validTypes.includes(file.type)) {
        input.classList.add('is-invalid');
        const feedbackId = input.id === 'image' ? 'imageInvalidFeedback' : 'editImageInvalidFeedback';
        document.getElementById(feedbackId).textContent = 'Please select a valid image file (JPG, PNG, GIF)';
        return false;
    }
    
    if (file.size > maxSize) {
        input.classList.add('is-invalid');
        const feedbackId = input.id === 'image' ? 'imageInvalidFeedback' : 'editImageInvalidFeedback';
        document.getElementById(feedbackId).textContent = 'Image size cannot exceed 5MB';
        return false;
    }
    
    input.classList.remove('is-invalid');
    return true;
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialize all modals
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => new bootstrap.Modal(modal));
    
    // Get a reference to the delete modal
    deleteImageModal = new bootstrap.Modal(document.getElementById('deleteImageModal'));
    
    // Initialize word count for add form
    const titleInput = document.getElementById('title');
    const descInput = document.getElementById('description');
    
    if (titleInput && document.getElementById('titleWordCount')) {
        titleInput.addEventListener('input', function() {
            updateWordCount(this, document.getElementById('titleWordCount'), 20);
            
            // Real-time validation
            if (this.value.length < 3 || this.value.length > 50) {
                this.classList.add('is-invalid');
                document.getElementById('titleInvalidFeedback').textContent = 'Title must be between 3 and 50 characters.';
            } else if (countWords(this.value) > 20) {
                this.classList.add('is-invalid');
                document.getElementById('titleInvalidFeedback').textContent = 'Title cannot exceed 20 words.';
            } else if (hasRepeatedCharacters(this.value, 5)) {
                this.classList.add('is-invalid');
                document.getElementById('titleInvalidFeedback').textContent = 'Title contains too many repeated characters.';
            } else {
                this.classList.remove('is-invalid');
            }
        });
    }
    
    if (descInput && document.getElementById('descWordCount')) {
        descInput.addEventListener('input', function() {
            updateWordCount(this, document.getElementById('descWordCount'), 100);
            
            // Real-time validation
            if (this.value.length < 10 || this.value.length > 500) {
                this.classList.add('is-invalid');
                document.getElementById('descriptionInvalidFeedback').textContent = 'Description must be between 10 and 500 characters.';
            } else if (countWords(this.value) > 100) {
                this.classList.add('is-invalid');
                document.getElementById('descriptionInvalidFeedback').textContent = 'Description cannot exceed 100 words.';
            } else if (hasRepeatedCharacters(this.value, 5)) {
                this.classList.add('is-invalid');
                document.getElementById('descriptionInvalidFeedback').textContent = 'Description contains too many repeated characters.';
            } else {
                this.classList.remove('is-invalid');
            }
        });
    }
    
    // Initialize word count for edit form
    const editTitleInput = document.getElementById('editTitle');
    const editDescInput = document.getElementById('editDescription');
    
    if (editTitleInput && document.getElementById('editTitleWordCount')) {
        editTitleInput.addEventListener('input', function() {
            updateWordCount(this, document.getElementById('editTitleWordCount'), 20);
            
            // Real-time validation
            if (this.value.length < 3 || this.value.length > 50) {
                this.classList.add('is-invalid');
                document.getElementById('editTitleInvalidFeedback').textContent = 'Title must be between 3 and 50 characters.';
            } else if (countWords(this.value) > 20) {
                this.classList.add('is-invalid');
                document.getElementById('editTitleInvalidFeedback').textContent = 'Title cannot exceed 20 words.';
            } else if (hasRepeatedCharacters(this.value, 5)) {
                this.classList.add('is-invalid');
                document.getElementById('editTitleInvalidFeedback').textContent = 'Title contains too many repeated characters.';
            } else {
                this.classList.remove('is-invalid');
            }
        });
    }
    
    if (editDescInput && document.getElementById('editDescWordCount')) {
        editDescInput.addEventListener('input', function() {
            updateWordCount(this, document.getElementById('editDescWordCount'), 100);
            
            // Real-time validation
            if (this.value.length < 10 || this.value.length > 500) {
                this.classList.add('is-invalid');
                document.getElementById('editDescriptionInvalidFeedback').textContent = 'Description must be between 10 and 500 characters.';
            } else if (countWords(this.value) > 100) {
                this.classList.add('is-invalid');
                document.getElementById('editDescriptionInvalidFeedback').textContent = 'Description cannot exceed 100 words.';
            } else if (hasRepeatedCharacters(this.value, 5)) {
                this.classList.add('is-invalid');
                document.getElementById('editDescriptionInvalidFeedback').textContent = 'Description contains too many repeated characters.';
            } else {
                this.classList.remove('is-invalid');
            }
        });
    }
    
    // Add image file validation
    const imageInput = document.getElementById('image');
    const editImageInput = document.getElementById('editImage');
    
    if (imageInput) {
        imageInput.addEventListener('change', function() {
            validateImageFile(this);
        });
    }
    
    if (editImageInput) {
        editImageInput.addEventListener('change', function() {
            validateImageFile(this);
        });
    }
    
    // Update form validations to use the image validation function
    document.getElementById('addImageForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const titleInput = document.getElementById('title');
        const descInput = document.getElementById('description');
        const categoryInput = document.getElementById('category');
        const imageInput = document.getElementById('image');
        let isValid = true;
        
        // Reset validation states
        titleInput.classList.remove('is-invalid');
        descInput.classList.remove('is-invalid');
        imageInput.classList.remove('is-invalid');
        
        // Validate title
        if (titleInput.value.length < 3 || titleInput.value.length > 50) {
            titleInput.classList.add('is-invalid');
            document.getElementById('titleInvalidFeedback').textContent = 'Title must be between 3 and 50 characters.';
            isValid = false;
        } else if (countWords(titleInput.value) > 20) {
            titleInput.classList.add('is-invalid');
            document.getElementById('titleInvalidFeedback').textContent = 'Title cannot exceed 20 words.';
            isValid = false;
        } else if (hasRepeatedCharacters(titleInput.value, 5)) {
            titleInput.classList.add('is-invalid');
            document.getElementById('titleInvalidFeedback').textContent = 'Title contains too many repeated characters.';
            isValid = false;
        }
        
        // Validate description
        if (descInput.value.length < 10 || descInput.value.length > 500) {
            descInput.classList.add('is-invalid');
            document.getElementById('descriptionInvalidFeedback').textContent = 'Description must be between 10 and 500 characters.';
            isValid = false;
        } else if (countWords(descInput.value) > 100) {
            descInput.classList.add('is-invalid');
            document.getElementById('descriptionInvalidFeedback').textContent = 'Description cannot exceed 100 words.';
            isValid = false;
        } else if (hasRepeatedCharacters(descInput.value, 5)) {
            descInput.classList.add('is-invalid');
            document.getElementById('descriptionInvalidFeedback').textContent = 'Description contains too many repeated characters.';
            isValid = false;
        }
        
        // Validate image
        if (!validateImageFile(imageInput)) {
            isValid = false;
        }
        
        if (isValid) {
            this.submit();
        }
    });
    
    // Edit form validation
    document.getElementById('editImageForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const titleInput = document.getElementById('editTitle');
        const descInput = document.getElementById('editDescription');
        const categoryInput = document.getElementById('editCategory');
        const imageInput = document.getElementById('editImage');
        let isValid = true;
        
        // Reset validation states
        titleInput.classList.remove('is-invalid');
        descInput.classList.remove('is-invalid');
        imageInput.classList.remove('is-invalid');
        
        // Validate title
        if (titleInput.value.length < 3 || titleInput.value.length > 50) {
            titleInput.classList.add('is-invalid');
            document.getElementById('editTitleInvalidFeedback').textContent = 'Title must be between 3 and 50 characters.';
            isValid = false;
        } else if (countWords(titleInput.value) > 20) {
            titleInput.classList.add('is-invalid');
            document.getElementById('editTitleInvalidFeedback').textContent = 'Title cannot exceed 20 words.';
            isValid = false;
        } else if (hasRepeatedCharacters(titleInput.value, 5)) {
            titleInput.classList.add('is-invalid');
            document.getElementById('editTitleInvalidFeedback').textContent = 'Title contains too many repeated characters.';
            isValid = false;
        }
        
        // Validate description
        if (descInput.value.length < 10 || descInput.value.length > 500) {
            descInput.classList.add('is-invalid');
            document.getElementById('editDescriptionInvalidFeedback').textContent = 'Description must be between 10 and 500 characters.';
            isValid = false;
        } else if (countWords(descInput.value) > 100) {
            descInput.classList.add('is-invalid');
            document.getElementById('editDescriptionInvalidFeedback').textContent = 'Description cannot exceed 100 words.';
            isValid = false;
        } else if (hasRepeatedCharacters(descInput.value, 5)) {
            descInput.classList.add('is-invalid');
            document.getElementById('editDescriptionInvalidFeedback').textContent = 'Description contains too many repeated characters.';
            isValid = false;
        }
        
        // Validate image
        if (!validateImageFile(imageInput)) {
            isValid = false;
        }
        
        if (isValid) {
            this.submit();
        }
    });

    // View gallery image buttons
    document.querySelectorAll('.view-gallery-btn').forEach(function(button) {
        button.addEventListener('click', function() {
            const src = this.getAttribute('data-src');
            const title = this.getAttribute('data-title');
            const description = this.getAttribute('data-description');
            const category = this.getAttribute('data-category');
            viewImage(src, title, description, category);
        });
    });
    
    // Edit gallery image buttons
    document.querySelectorAll('.edit-gallery-btn').forEach(function(button) {
        button.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const title = this.getAttribute('data-title');
            const description = this.getAttribute('data-description');
            const category = this.getAttribute('data-category');
            editImage(id, title, description, category);
        });
    });
    
    // Delete gallery image buttons
    document.querySelectorAll('.delete-gallery-btn').forEach(function(button) {
        button.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            deleteImage(id);
        });
    });
});

function deleteImage(imageId) {
    imageIdToDelete = imageId;
    deleteImageModal.show();
}

function confirmDeleteImage() {
    if (!imageIdToDelete) return;
    
    fetch(`/admin/gallery/${imageIdToDelete}`, {
        method: 'DELETE',
        headers: {
            'X-CSRFToken': '{{ csrf_token() }}'
        }
    })
    .then(response => response.json())
    .then(data => {
        // Close the modal first
        deleteImageModal.hide();
        
        if (data.success) {
            // Show success message with animation
            const container = document.querySelector('.card-body');
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success alert-dismissible fade show mt-3';
            successAlert.innerHTML = `
                Image deleted successfully
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            // Insert at the top of the container
            container.insertBefore(successAlert, container.firstChild);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                const bsAlert = new bootstrap.Alert(successAlert);
                bsAlert.close();
            }, 5000);
            
            // Remove the image card from the UI
            const card = document.querySelector(`button[onclick="deleteImage(${imageIdToDelete})"]`).closest('.col-md-4');
            card.classList.add('fade-out');
            setTimeout(() => {
                card.remove();
                
                // Check if there are no more images
                const remainingCards = document.querySelectorAll('.card-body .col-md-4').length;
                if (remainingCards === 0) {
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);
                }
            }, 300);
        } else {
            alert('Failed to delete image');
        }
    })
    .catch(error => {
        deleteImageModal.hide();
        console.error('Error:', error);
        alert('An error occurred while deleting the image');
    });
}

function viewImage(src, title, description, category) {
    const modal = new bootstrap.Modal(document.getElementById('viewImageModal'));
    document.getElementById('viewImageTitle').textContent = title;
    const fallbackDiv = document.getElementById('viewImageFallback');
    
    if (src) {
        document.getElementById('viewImageSrc').src = src;
        document.getElementById('viewImageSrc').style.display = 'block';
        fallbackDiv.style.display = 'none';
    } else {
        document.getElementById('viewImageSrc').style.display = 'none';
        fallbackDiv.style.display = 'flex';
        
        // Update fallback icon based on category
        const iconClass = getCategoryIcon(category);
        fallbackDiv.innerHTML = `<i class="${iconClass} fa-5x text-secondary"></i>`;
    }
    document.getElementById('viewImageDescription').textContent = description;
    modal.show();
}

function getCategoryIcon(category) {
    switch(category) {
        case 'room':
            return 'fas fa-bed';
        case 'dining':
            return 'fas fa-utensils';
        case 'pool':
            return 'fas fa-swimming-pool';
        case 'spa':
            return 'fas fa-spa';
        default:
            return 'fas fa-image';
    }
}

function editImage(id, title, description, category) {
    const modal = new bootstrap.Modal(document.getElementById('editImageModal'));
    document.getElementById('editImageId').value = id;
    document.getElementById('editTitle').value = title;
    document.getElementById('editDescription').value = description;
    document.getElementById('editCategory').value = category;
    
    // Update form action
    document.getElementById('editImageForm').action = `/admin/gallery/${id}/edit`;
    
    modal.show();
}
</script>

<style>
.action-buttons {
    display: flex;
    gap: 8px;
}

.action-buttons .btn {
    border-radius: 4px !important;
}

/* Override btn-group styles that might affect spacing */
.btn-group.action-buttons {
    display: flex;
}

.btn-group.action-buttons > .btn:not(:last-child) {
    border-top-right-radius: 4px !important;
    border-bottom-right-radius: 4px !important;
    margin-right: 0;
}

.btn-group.action-buttons > .btn:not(:first-child) {
    border-top-left-radius: 4px !important;
    border-bottom-left-radius: 4px !important;
    margin-left: 0;
}

.light-button {
    background: linear-gradient(135deg, #42A5F5, #64B5F6);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.btn-view,
.btn-edit,
.btn-delete {
    width: 36px;
    height: 36px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
}

.btn-view {
    background: linear-gradient(135deg, #42A5F5, #64B5F6);
    color: white;
}

.btn-view:hover {
    background: linear-gradient(135deg, #2196F3, #42A5F5);
    color: white;
}

.btn-edit {
    background-color: #ffc107;
    color: white;
}

.btn-edit:hover {
    background-color: #e0a800;
    color: white;
}

.btn-delete {
    background-color: #dc3545;
    color: white;
}

.btn-delete:hover {
    background-color: #c82333;
    color: white;
}

.action-buttons .btn i {
    font-size: 14px;
}

/* Add fade-out animation style */
.fade-out {
    opacity: 0;
    transition: opacity 0.3s ease-out;
}

/* Word count styles */
.word-count {
    font-size: 0.85rem;
    color: #6c757d;
    text-align: right;
    margin-top: 0.25rem;
}

.word-count.exceeded {
    color: #dc3545;
    font-weight: bold;
}

/* Add validation styling for image input */
.form-control.is-invalid {
    border-color: #dc3545;
    padding-right: calc(1.5em + 0.75rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.form-control.is-invalid:focus {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
}

/* Gallery card styling */
.description-container {
    scrollbar-width: thin;
    scrollbar-color: #ccc #f5f5f5;
}

.description-container::-webkit-scrollbar {
    width: 6px;
}

.description-container::-webkit-scrollbar-track {
    background: #f5f5f5;
}

.description-container::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 6px;
}

.card.h-100 {
    transition: transform 0.2s, box-shadow 0.2s;
}

.card.h-100:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.card-title {
    height: 48px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    margin-bottom: 10px;
}
</style>
{% endblock %} 